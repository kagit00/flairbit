<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

    <!-- Create Table -->
    <changeSet id="20251102-01-create-match-requests" author="grok">

        <sql dbms="postgresql">
            CREATE TABLE match_requests (
            id UUID NOT NULL DEFAULT gen_random_uuid(),
            from_profile_id UUID NOT NULL,
            to_profile_id UUID NOT NULL,
            group_id VARCHAR(255) NOT NULL,
            status VARCHAR(50) NOT NULL DEFAULT 'PENDING',
            created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
            version BIGINT NOT NULL DEFAULT 0,
            PRIMARY KEY (id),
            CONSTRAINT uk_match_request_from_to UNIQUE (from_profile_id, to_profile_id, group_id)
            );
        </sql>

    </changeSet>

    <!-- Foreign Keys -->
    <changeSet id="20251102-02-fk-match-requests" author="grok">

        <sql dbms="postgresql">
            ALTER TABLE match_requests
            ADD CONSTRAINT fk_match_requests_from_profile
            FOREIGN KEY (from_profile_id)
            REFERENCES profiles(id);

            ALTER TABLE match_requests
            ADD CONSTRAINT fk_match_requests_to_profile
            FOREIGN KEY (to_profile_id)
            REFERENCES profiles(id);
        </sql>

    </changeSet>

    <!-- Indexes -->
    <changeSet id="20251102-03-index-match-requests" author="grok">

        <sql dbms="postgresql">
            CREATE INDEX idx_match_requests_from_profile ON match_requests(from_profile_id);
            CREATE INDEX idx_match_requests_to_profile ON match_requests(to_profile_id);
            CREATE INDEX idx_match_requests_group_id ON match_requests(group_id);
            CREATE INDEX idx_match_requests_status ON match_requests(status);
            CREATE INDEX idx_match_requests_created_at ON match_requests(created_at);
        </sql>

    </changeSet>

</databaseChangeLog>
